### üåê PRUEBAS DE TRADUCCI√ìN AUTOM√ÅTICA DE MENSAJES
###
### Este archivo demuestra la traducci√≥n autom√°tica de mensajes entre pacientes y doctores
### con diferentes idiomas nativos.
###
### IMPORTANTE: Aseg√∫rate de tener usuarios con diferentes idiomas nativos configurados

@baseUrl = http://localhost:3000

# ==========================================
# VARIABLES - Reemplaza con tus tokens reales
# ==========================================

# Token de paciente con idioma nativo INGL√âS (en)
@patientToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Token de doctor con idioma nativo ESPA√ëOL (es)
@doctorToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# ID de conversaci√≥n entre paciente y doctor
@conversationId = 1

# ==========================================
# PREREQUISITO: Configurar idiomas nativos
# ==========================================

###
# 1. ‚úÖ Actualizar idioma nativo del paciente a INGL√âS (ejecutar como ADMIN)
# Primero necesitas tener registros en la tabla NativeLanguages
# INSERT INTO NativeLanguages (Code, Name) VALUES ('en', 'English'), ('es', 'Espa√±ol');

###
# 2. ‚úÖ Crear conversaci√≥n entre paciente y doctor
POST {{baseUrl}}/conversations
Authorization: Bearer {{patientToken}}
Content-Type: application/json

{
  "ParticipantUserIds": [1, 2],
  "AppointmentId": null
}

# Respuesta esperada:
# {
#   "id": "1",
#   "appointmentId": null,
#   "createdBy": "1",
#   "createdAt": "2025-01-15T10:00:00.000Z"
# }

# ==========================================
# PRUEBAS DE TRADUCCI√ìN AUTOM√ÅTICA
# ==========================================

###
# 3. ‚úÖ PACIENTE (ingl√©s) env√≠a mensaje en INGL√âS
# El doctor recibir√° el mensaje original + traducci√≥n al espa√±ol
POST {{baseUrl}}/conversations/{{conversationId}}/messages
Authorization: Bearer {{patientToken}}
Content-Type: application/json

{
  "Content": "Hello doctor! I have been experiencing severe headaches for the past 3 days. The pain is concentrated on the right side of my head and gets worse in the afternoon.",
  "Language": "en"
}

# Respuesta esperada:
# {
#   "Id": "1",
#   "ConversationId": "1",
#   "SenderUserId": "1",
#   "Type": "text",
#   "Content": "Hello doctor! I have been experiencing severe headaches...",
#   "Language": "en",
#   "CreatedAt": "2025-01-15T10:05:00.000Z"
# }
#
# El mensaje emitido por WebSocket incluir√°:
# {
#   ...mensaje original...,
#   "Translations": [
#     {
#       "Language": "es",
#       "Content": "¬°Hola doctor! He estado experimentando dolores de cabeza severos durante los √∫ltimos 3 d√≠as. El dolor se concentra en el lado derecho de mi cabeza y empeora por la tarde.",
#       "Engine": "LibreTranslate"
#     }
#   ]
# }

###
# 4. ‚úÖ DOCTOR (espa√±ol) env√≠a mensaje en ESPA√ëOL
# El paciente recibir√° el mensaje original + traducci√≥n al ingl√©s
POST {{baseUrl}}/conversations/{{conversationId}}/messages
Authorization: Bearer {{doctorToken}}
Content-Type: application/json

{
  "Content": "Buenos d√≠as. Entiendo su preocupaci√≥n. ¬øHa tenido n√°useas o sensibilidad a la luz? ¬øCu√°ndo fue la √∫ltima vez que tuvo un dolor de cabeza similar?",
  "Language": "es"
}

# El mensaje emitido por WebSocket incluir√°:
# {
#   ...mensaje original...,
#   "Translations": [
#     {
#       "Language": "en",
#       "Content": "Good morning. I understand your concern. Have you had nausea or sensitivity to light? When was the last time you had a similar headache?",
#       "Engine": "LibreTranslate"
#     }
#   ]
# }

###
# 5. ‚úÖ PACIENTE (ingl√©s) responde en INGL√âS
POST {{baseUrl}}/conversations/{{conversationId}}/messages
Authorization: Bearer {{patientToken}}
Content-Type: application/json

{
  "Content": "Yes, I have been feeling nauseous and the light bothers me a lot. I haven't had a headache like this in about 6 months.",
  "Language": "en"
}

###
# 6. ‚úÖ DOCTOR (espa√±ol) da diagn√≥stico en ESPA√ëOL
POST {{baseUrl}}/conversations/{{conversationId}}/messages
Authorization: Bearer {{doctorToken}}
Content-Type: application/json

{
  "Content": "Bas√°ndome en sus s√≠ntomas, parece ser una migra√±a. Le recomiendo descansar en una habitaci√≥n oscura y tomar ibuprofeno 400mg cada 8 horas. Si los s√≠ntomas persisten por m√°s de 48 horas, debe acudir a urgencias.",
  "Language": "es"
}

# ==========================================
# CONSULTAR MENSAJES CON TRADUCCIONES
# ==========================================

###
# 7. ‚úÖ PACIENTE consulta mensajes (ver√° traducciones al ingl√©s)
GET {{baseUrl}}/conversations/{{conversationId}}/messages
Authorization: Bearer {{patientToken}}

# Respuesta esperada:
# [
#   {
#     "Id": "1",
#     "Content": "Hello doctor! I have been experiencing...",
#     "Language": "en",
#     "SenderUserId": "1",
#     "Translation": null,  // No hay traducci√≥n porque es su idioma
#     "TranslationLanguage": null
#   },
#   {
#     "Id": "2",
#     "Content": "Buenos d√≠as. Entiendo su preocupaci√≥n...",
#     "Language": "es",
#     "SenderUserId": "2",
#     "Translation": "Good morning. I understand your concern...",
#     "TranslationLanguage": "en"
#   },
#   {
#     "Id": "3",
#     "Content": "Yes, I have been feeling nauseous...",
#     "Language": "en",
#     "SenderUserId": "1",
#     "Translation": null,
#     "TranslationLanguage": null
#   },
#   {
#     "Id": "4",
#     "Content": "Bas√°ndome en sus s√≠ntomas, parece ser una migra√±a...",
#     "Language": "es",
#     "SenderUserId": "2",
#     "Translation": "Based on your symptoms, it seems to be a migraine...",
#     "TranslationLanguage": "en"
#   }
# ]

###
# 8. ‚úÖ DOCTOR consulta mensajes (ver√° traducciones al espa√±ol)
GET {{baseUrl}}/conversations/{{conversationId}}/messages
Authorization: Bearer {{doctorToken}}

# Respuesta esperada:
# [
#   {
#     "Id": "1",
#     "Content": "Hello doctor! I have been experiencing...",
#     "Language": "en",
#     "SenderUserId": "1",
#     "Translation": "¬°Hola doctor! He estado experimentando dolores de cabeza severos...",
#     "TranslationLanguage": "es"
#   },
#   {
#     "Id": "2",
#     "Content": "Buenos d√≠as. Entiendo su preocupaci√≥n...",
#     "Language": "es",
#     "SenderUserId": "2",
#     "Translation": null,  // No hay traducci√≥n porque es su idioma
#     "TranslationLanguage": null
#   },
#   ...
# ]

# ==========================================
# PRUEBAS ADICIONALES - MENSAJES SIN IDIOMA
# ==========================================

###
# 9. ‚úÖ Enviar mensaje sin especificar idioma (se detectar√° autom√°ticamente)
POST {{baseUrl}}/conversations/{{conversationId}}/messages
Authorization: Bearer {{patientToken}}
Content-Type: application/json

{
  "Content": "Thank you doctor, I will follow your recommendations."
}

# El sistema usar√° el idioma nativo del paciente (ingl√©s) como idioma del mensaje

###
# 10. ‚úÖ Enviar mensaje corto (no se traduce si es muy corto)
POST {{baseUrl}}/conversations/{{conversationId}}/messages
Authorization: Bearer {{doctorToken}}
Content-Type: application/json

{
  "Content": "Ok"
}

# ==========================================
# VERIFICAR TRADUCCIONES EN LA BASE DE DATOS
# ==========================================

# Para verificar que las traducciones se guardaron correctamente:
# SELECT m.Id, m.Content, m.Language, mt.Language as TranslationLang, mt.Content as Translation
# FROM Messages m
# LEFT JOIN MessageTranslations mt ON m.Id = mt.MessageId
# WHERE m.ConversationId = 1
# ORDER BY m.CreatedAt ASC;

# ==========================================
# NOTAS IMPORTANTES
# ==========================================

# 1. El sistema usa MyMemory Translation API por defecto (GRATUITA)
#    - Completamente gratuita, sin API key
#    - 1000 palabras/d√≠a sin l√≠mite
#    - Para producci√≥n, considera LibreTranslate self-hosted o APIs comerciales
#
# 2. Variables de entorno opcionales:
#    TRANSLATION_PROVIDER=mymemory  (default)
#    TRANSLATION_API_URL=https://api.mymemory.translated.net/get
#
# 3. Para cambiar a LibreTranslate (mejor calidad):
#    TRANSLATION_PROVIDER=libretranslate
#    TRANSLATION_API_URL=http://localhost:5000/translate
#    Ver documentaci√≥n: docs/TRANSLATION_APIS.md
#
# 3. Idiomas soportados por LibreTranslate:
#    - en (English)
#    - es (Espa√±ol)
#    - fr (Fran√ßais)
#    - de (Deutsch)
#    - pt (Portugu√™s)
#    - it (Italiano)
#    - ja (Êó•Êú¨Ë™û)
#    - ko (ÌïúÍµ≠Ïñ¥)
#    - zh (‰∏≠Êñá)
#    - ar (ÿßŸÑÿπÿ±ÿ®Ÿäÿ©)
#    - ru (–†—É—Å—Å–∫–∏–π)
#    - y muchos m√°s...
#
# 4. El cliente WebSocket recibir√° los mensajes con este formato:
#    socket.on('message:new', (data) => {
#      console.log('Mensaje original:', data.Content);
#      console.log('Idioma original:', data.Language);
#      console.log('Traducciones disponibles:', data.Translations);
#
#      // Buscar traducci√≥n en el idioma del usuario
#      const userLang = 'es';
#      const translation = data.Translations.find(t => t.Language === userLang);
#      if (translation) {
#        console.log('Traducci√≥n:', translation.Content);
#      }
#    });
